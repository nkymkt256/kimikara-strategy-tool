// Settings.gs
/**
 * スクリプトプロパティから値を取得するヘルパー関数
 * @param {string} key - プロパティのキー
 * @param {string} [defaultValue] - (オプション) プロパティが見つからない場合のデフォルト値
 * @returns {string} プロパティの値
 */
function getProperty_(key, defaultValue = null) {
  const value = PropertiesService.getScriptProperties().getProperty(key);

  if (value === null) {
    // デフォルト値が指定されていればそれを返す
    if (defaultValue !== null) {
      return defaultValue;
    }
    // デフォルト値がなく、必須のプロパティが見つからない場合はエラー
    throw new Error(`
      スクリプト プロパティ '${key}' が設定されていません。
      GASエディタの [プロジェクト設定] > [スクリプト プロパティ] で設定してください。
    `);
  }
  return value;
}

/**
 * プロジェクト全体の設定値
 * (機密情報は PropertiesService から読み込む)
 */
const SETTINGS = {

  GCP: {
    // (必須) スクリプトプロパティから読み込む
    PROJECT_ID: getProperty_('GCP_PROJECT_ID'),

    // (固定値) モデル名は機密情報ではないため、コードに記述してOK
    // 利用可能なモデル: gemini-1.5-flash, gemini-1.5-pro, gemini-2.0-flash-exp
    GEMINI_MODEL: 'gemini-1.5-flash'
  },

  SS_IDS: {
    // (必須) スクリプトプロパティから読み込む
    STUDENT_LIST: getProperty_('SS_ID_STUDENT_LIST'),
    FEEDBACK: getProperty_('SS_ID_FEEDBACK', ''),
    GOAL_MANAGEMENT: getProperty_('SS_ID_GOAL_MANAGEMENT', '')
  },

  SHEET_NAMES: {
    // (固定値) シート名は機密情報ではないため、コードに記述してOK
    STUDENTS: '全生徒一覧',
    FEEDBACK: 'レッスンふりかえり',
    GOALS: '目標一覧',
    LESSON_STRATEGY: '本日のレッスンの作戦'
  },

  SHEET_GIDS: {
    // (オプション) シートGIDを指定する場合はスクリプトプロパティから読み込む
    // シート名での取得に失敗する場合に使用
    STUDENTS: getProperty_('SHEET_GID_STUDENTS', null)
  },

  DRIVE: {
    // (任意) スライド保存先フォルダID。
    // getProperty_ の第2引数にデフォルト値(null)を指定すると、
    // 未設定の場合にエラーではなく null (または空文字) が返る
    SLIDES_FOLDER_ID: getProperty_('SLIDES_FOLDER_ID', null),
    // (任意) 生徒ごとの目標シート保存先フォルダID
    // フォルダ内に「レッスン情報_生徒名」という名前のスプレッドシートが保存されている
    GOAL_SHEETS_FOLDER_ID: getProperty_('GOAL_SHEETS_FOLDER_ID', null)
  }
};
